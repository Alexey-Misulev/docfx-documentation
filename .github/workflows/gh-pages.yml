# .github/workflows/docs.yml
name: ğŸ“– Publish Documentation

on:
  push:
    branches: [ main ]

permissions:
  actions: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  publish-docs:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v3

      - name: ğŸ§± Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.x'

      # === ğŸ” ĞĞ¢Ğ›ĞĞ”ĞšĞ 1: Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ ===
      - name: ğŸ” List all .cs and .csproj files
        run: |
          echo "=== .cs files ==="
          find . -name "*.cs" | sort
          echo "=== .csproj files ==="
          find . -name "*.csproj" | sort
          echo "=== MyPackage folder ==="
          ls -la MyPackage/ 2>/dev/null || echo "MyPackage/ not found"

      # === ğŸ” ĞĞ¢Ğ›ĞĞ”ĞšĞ 2: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ .csproj ===
      - name: ğŸ” Show MyPackage.csproj content
        run: |
          if [ -f "MyPackage/MyPackage.csproj" ]; then
            echo "=== MyPackage.csproj content ==="
            cat MyPackage/MyPackage.csproj
          else
            echo "MyPackage.csproj not found!"
          fi

      # === ğŸ” ĞĞ¢Ğ›ĞĞ”ĞšĞ 3: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ .cs Ñ„Ğ°Ğ¹Ğ»Ğ° ===
      - name: ğŸ” Show first .cs file content (for XML comments check)
        run: |
          CS_FILE=$(find . -name "*.cs" | head -n1)
          if [ -n "$CS_FILE" ]; then
            echo "=== First .cs file: $CS_FILE ==="
            head -n10 "$CS_FILE"
          else
            echo "No .cs files found!"
          fi

      - name: ğŸ“¦ Install DocFX
        run: dotnet tool install -g docfx

      - name: ğŸ“š Build documentation
        run: |
          docfx Documentation/docfx.json

      # === ğŸ” ĞĞ¢Ğ›ĞĞ”ĞšĞ 4: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° ÑĞ±Ğ¾Ñ€ĞºĞ¸ ===
      - name: ğŸ” Check Documentation/_site contents
        run: |
          echo "=== Documentation/_site/ ==="
          ls -la Documentation/_site/
          echo "=== Documentation/_site/api/ ==="
          ls -la Documentation/_site/api/ 2>/dev/null || echo "api/ directory not created"
          echo "=== Check if index.html exists ==="
          if [ -f "Documentation/_site/index.html" ]; then
            echo "âœ… index.html exists"
          else
            echo "âŒ index.html MISSING"
          fi

      # === ğŸ” ĞĞ¢Ğ›ĞĞ”ĞšĞ 5: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… .yml Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² API ===
      - name: ğŸ” Check api YAML files (raw metadata)
        run: |
          echo "=== api/ folder in working dir (before build) ==="
          ls -la Documentation/api/ 2>/dev/null || echo "Documentation/api/ not found (expected before 'build' step)"
          echo "=== Content of first .yml in api/ ==="
          find Documentation/api -name "*.yml" | head -n1 | xargs cat 2>/dev/null || echo "No .yml files generated"

      - name: ğŸ“¤ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'Documentation/_site'

      - name: ğŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4